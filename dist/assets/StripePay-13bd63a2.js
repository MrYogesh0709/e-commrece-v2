import{R as s,a as oe,m as ie,r as _,j as b}from"./index-c94445e5.js";import{P as c}from"./index-8100b1b7.js";var se="https://js.stripe.com/v3",Ee=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Q="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",be=function(){for(var e=document.querySelectorAll('script[src^="'.concat(se,'"]')),t=0;t<e.length;t++){var n=e[t];if(Ee.test(n.src))return n}return null},we=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(se).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(n),n},xe=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"1.54.1",startTime:t})},W=null,je=function(e){return W!==null||(W=new Promise(function(t,n){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe&&e&&console.warn(Q),window.Stripe){t(window.Stripe);return}try{var a=be();a&&e?console.warn(Q):a||(a=we(e)),a.addEventListener("load",function(){window.Stripe?t(window.Stripe):n(new Error("Stripe.js not available"))}),a.addEventListener("error",function(){n(new Error("Failed to load Stripe.js"))})}catch(o){n(o);return}})),W},Pe=function(e,t,n){if(e===null)return null;var a=e.apply(void 0,t);return xe(a,n),a},ce=Promise.resolve().then(function(){return je(null)}),ue=!1;ce.catch(function(r){ue||console.warn(r)});var Oe=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];ue=!0;var a=Date.now();return ce.then(function(o){return Pe(o,t,a)})};function Z(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),t.push.apply(t,n)}return t}function ee(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Z(Object(t),!0).forEach(function(n){le(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):Z(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function $(r){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?$=function(e){return typeof e}:$=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(r)}function le(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function B(r,e){return Ae(r)||Re(r,e)||ke(r,e)||_e()}function Ae(r){if(Array.isArray(r))return r}function Re(r,e){var t=r&&(typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"]);if(t!=null){var n=[],a=!0,o=!1,u,m;try{for(t=t.call(r);!(a=(u=t.next()).done)&&(n.push(u.value),!(e&&n.length===e));a=!0);}catch(i){o=!0,m=i}finally{try{!a&&t.return!=null&&t.return()}finally{if(o)throw m}}return n}}function ke(r,e){if(r){if(typeof r=="string")return te(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);if(t==="Object"&&r.constructor&&(t=r.constructor.name),t==="Map"||t==="Set")return Array.from(r);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return te(r,e)}}function te(r,e){(e==null||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function _e(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var G=function(e){var t=s.useRef(e);return s.useEffect(function(){t.current=e},[e]),t.current},O=function(e){return e!==null&&$(e)==="object"},Ne=function(e){return O(e)&&typeof e.then=="function"},Le=function(e){return O(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},re="[object Object]",Te=function r(e,t){if(!O(e)||!O(t))return e===t;var n=Array.isArray(e),a=Array.isArray(t);if(n!==a)return!1;var o=Object.prototype.toString.call(e)===re,u=Object.prototype.toString.call(t)===re;if(o!==u)return!1;if(!o&&!n)return e===t;var m=Object.keys(e),i=Object.keys(t);if(m.length!==i.length)return!1;for(var h={},v=0;v<m.length;v+=1)h[m[v]]=!0;for(var w=0;w<i.length;w+=1)h[i[w]]=!0;var C=Object.keys(h);if(C.length!==m.length)return!1;var A=e,R=t,E=function(P){return r(A[P],R[P])};return C.every(E)},pe=function(e,t,n){return O(e)?Object.keys(e).reduce(function(a,o){var u=!O(t)||!Te(e[o],t[o]);return n.includes(o)?(u&&console.warn("Unsupported prop change: options.".concat(o," is not a mutable property.")),a):u?ee(ee({},a||{}),{},le({},o,e[o])):a},null):null},Ie="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",ne=function(e){if(e===null||Le(e))return e;throw new Error(Ie)},Ue=function(e){if(Ne(e))return{tag:"async",stripePromise:Promise.resolve(e).then(ne)};var t=ne(e);return t===null?{tag:"empty"}:{tag:"sync",stripe:t}},z=s.createContext(null);z.displayName="ElementsContext";var We=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},K=s.createContext(null);K.displayName="CartElementContext";var $e=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},fe=function(e){var t=e.stripe,n=e.options,a=e.children,o=s.useMemo(function(){return Ue(t)},[t]),u=s.useState(null),m=B(u,2),i=m[0],h=m[1],v=s.useState(null),w=B(v,2),C=w[0],A=w[1],R=s.useState(function(){return{stripe:o.tag==="sync"?o.stripe:null,elements:o.tag==="sync"?o.stripe.elements(n):null}}),E=B(R,2),S=E[0],P=E[1];s.useEffect(function(){var g=!0,L=function(T){P(function(I){return I.stripe?I:{stripe:T,elements:T.elements(n)}})};return o.tag==="async"&&!S.stripe?o.stripePromise.then(function(j){j&&g&&L(j)}):o.tag==="sync"&&!S.stripe&&L(o.stripe),function(){g=!1}},[o,S,n]);var k=G(t);s.useEffect(function(){k!==null&&k!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[k,t]);var N=G(n);return s.useEffect(function(){if(S.elements){var g=pe(n,N,["clientSecret","fonts"]);g&&S.elements.update(g)}},[n,N,S.elements]),s.useEffect(function(){var g=S.stripe;!g||!g._registerWrapper||!g.registerAppInfo||(g._registerWrapper({name:"react-stripe-js",version:"2.1.1"}),g.registerAppInfo({name:"react-stripe-js",version:"2.1.1",url:"https://stripe.com/docs/stripe-js/react"}))},[S.stripe]),s.createElement(z.Provider,{value:S},s.createElement(K.Provider,{value:{cart:i,setCart:h,cartState:C,setCartState:A}},a))};fe.propTypes={stripe:c.any,options:c.object};var q=function(e){var t=s.useContext(z);return We(t,e)},ae=function(e){var t=s.useContext(K);return $e(t,e)},Be=function(){var e=q("calls useElements()"),t=e.elements;return t},qe=function(){var e=q("calls useStripe()"),t=e.stripe;return t};c.func.isRequired;var y=function(e,t,n){var a=!!n,o=s.useRef(n);s.useEffect(function(){o.current=n},[n]),s.useEffect(function(){if(!a||!e)return function(){};var u=function(){o.current&&o.current.apply(o,arguments)};return e.on(t,u),function(){e.off(t,u)}},[a,t,e,o])},Me=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},l=function(e,t){var n="".concat(Me(e),"Element"),a=function(i){var h=i.id,v=i.className,w=i.options,C=w===void 0?{}:w,A=i.onBlur,R=i.onFocus,E=i.onReady,S=i.onChange,P=i.onEscape,k=i.onClick,N=i.onLoadError,g=i.onLoaderStart,L=i.onNetworksChange,j=i.onCheckout,T=i.onLineItemClick,I=i.onConfirm,de=i.onCancel,me=i.onShippingAddressChange,ve=i.onShippingRateChange,ye=q("mounts <".concat(n,">")),M=ye.elements,he=s.useState(null),J=B(he,2),f=J[0],Se=J[1],x=s.useRef(null),D=s.useRef(null),V=ae("mounts <".concat(n,">")),F=V.setCart,Y=V.setCartState;y(f,"blur",A),y(f,"focus",R),y(f,"escape",P),y(f,"click",k),y(f,"loaderror",N),y(f,"loaderstart",g),y(f,"networkschange",L),y(f,"lineitemclick",T),y(f,"confirm",I),y(f,"cancel",de),y(f,"shippingaddresschange",me),y(f,"shippingratechange",ve);var U;e==="cart"?U=function(H){Y(H),E&&E(H)}:E&&(e==="expressCheckout"?U=E:U=function(){E(f)}),y(f,"ready",U);var ge=e==="cart"?function(d){Y(d),S&&S(d)}:S;y(f,"change",ge);var Ce=e==="cart"?function(d){Y(d),j&&j(d)}:j;y(f,"checkout",Ce),s.useLayoutEffect(function(){if(x.current===null&&M&&D.current!==null){var d=M.create(e,C);e==="cart"&&F&&F(d),x.current=d,Se(d),d.mount(D.current)}},[M,C,F]);var X=G(C);return s.useEffect(function(){if(x.current){var d=pe(C,X,["paymentRequest"]);d&&x.current.update(d)}},[C,X]),s.useLayoutEffect(function(){return function(){if(x.current&&typeof x.current.destroy=="function")try{x.current.destroy(),x.current=null}catch{}}},[]),s.createElement("div",{id:h,className:v,ref:D})},o=function(i){q("mounts <".concat(n,">")),ae("mounts <".concat(n,">"));var h=i.id,v=i.className;return s.createElement("div",{id:h,className:v})},u=t?o:a;return u.propTypes={id:c.string,className:c.string,onChange:c.func,onBlur:c.func,onFocus:c.func,onReady:c.func,onEscape:c.func,onClick:c.func,onLoadError:c.func,onLoaderStart:c.func,onNetworksChange:c.func,onCheckout:c.func,onLineItemClick:c.func,onConfirm:c.func,onCancel:c.func,onShippingAddressChange:c.func,onShippingRateChange:c.func,options:c.object},u.displayName=n,u.__elementType=e,u},p=typeof window>"u";l("auBankAccount",p);l("card",p);l("cardNumber",p);l("cardExpiry",p);l("cardCvc",p);l("fpxBank",p);l("iban",p);l("idealBank",p);l("p24Bank",p);l("epsBank",p);var De=l("payment",p);l("expressCheckout",p);l("paymentRequestButton",p);l("linkAuthentication",p);l("address",p);l("shippingAddress",p);l("cart",p);l("paymentMethodMessaging",p);l("affirmMessage",p);l("afterpayClearpayMessage",p);function Fe(){const r=qe(),e=Be(),{currentOrder:t}=oe(ie),[n,a]=_.useState(null),[o,u]=_.useState(!1);_.useEffect(()=>{if(!r)return;const h=new URLSearchParams(window.location.search).get("payment_intent_client_secret");h&&r.retrievePaymentIntent(h).then(({paymentIntent:v})=>{switch(v.status){case"succeeded":a("Payment succeeded!");break;case"processing":a("Your payment is processing.");break;case"requires_payment_method":a("Your payment was not successful, please try again.");break;default:a("Something went wrong.");break}})},[r]);const m=async h=>{if(h.preventDefault(),!r||!e)return;u(!0);const{error:v}=await r.confirmPayment({elements:e,confirmParams:{return_url:`${window.location.origin}/order-success/${t.id}`}});v.type==="card_error"||v.type==="validation_error"?a(v.message):a("An unexpected error occurred."),u(!1)},i={layout:"tabs"};return b.jsx("div",{className:"flex justify-center items-center h-screen ",children:b.jsxs("form",{id:"payment-form",onSubmit:m,children:[b.jsx(De,{id:"payment-element",options:i}),b.jsx("button",{disabled:o||!r||!e,id:"submit",children:b.jsx("span",{id:"button-text",children:o?b.jsx("div",{className:"spinner",id:"spinner"}):"Pay now"})}),n&&b.jsx("div",{id:"payment-message",children:n})]})})}const Ye=Oe("pk_test_51NQ8b4SEqWDN6Gb7aE6oavYjjBntFMjelgJSiPBhxz98c1flRWdUOyZyyU5TeocYDpEa9lTnmkYE1T7vONv3ASf600FGghzb8q");function Ke(){const[r,e]=_.useState(""),{currentOrder:t}=oe(ie);_.useEffect(()=>{fetch("/api/v1/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({totalAmount:t.totalAmount,orderId:t.id})}).then(o=>o.json()).then(o=>e(o.clientSecret))},[]);const a={clientSecret:r,appearance:{theme:"stripe"}};return b.jsx("div",{className:"Stripe",children:r&&b.jsx(fe,{options:a,stripe:Ye,children:b.jsx(Fe,{})})})}export{Ke as default};
